%************************************************
\chapter{Residuos Cuadráticos}\label{ch:qr} 
%************************************************

%TODO
TODO : Párrafo de introducción al capítulo y referencias

% ref
% Handbook of applied
% A course in computational
% A Classical Introduction to Modern Number Theory
% Proofwifi ?
% http://www2.math.ou.edu/~kmartin/nti/

Teoría de símbolos de Lebesgue, ..., residuos cuadráticos, cálculo de raíz discreta?


%%%%%%

%TODO: número de raíces cuadradas de un número, y demostrar que nºraíces_cuadradas_de_un_numero X nºresiduos_cuadraticos = |Z_n^* |

% TODO: propiedad de los primos pq congruentes con 3 mod 4 que hace que el -1 es un no-residuo cuadrático mod n=pq, con símbolo de jacobi +1. n es un entero de Blum.

\section{Primeras propiedades}

% TODO: propiedad de que multiplicar dos no-residuos da un residuo

\begin{definition}
	Sea $a\in \mathbb{Z}^*_n$. Se dice que $a$ es un \textit{residuo cuadrático} módulo n, o un \textit{cuadrado} módulo n, si existe un $x \in \mathbb{Z}^*_n$ tal que $x^2 \equiv a \, mod \, n$.
	Si no existe dicho $x$, entonces $a$ se llama un \textit{no-residuo cuadrático} módulo n.
	
	Al conjunto de todos los residuos cuadráticos módulo n de $\mathbb{Z}^*_n$ los denotaremos como $Q_n$ o bien como $\mathbb{Z}^{Q+}_n$.
	Al conjunto de los no-residuos cuadráticos lo denotamos como $\overline{Q_n}$.
\end{definition}

\begin{example}
	Si tomamos $n=4$, los no-residuos cuadráticos son $2$ y $3$, y el único residuo cuadrático es $1$:
	\begin{align*}
		1^2 \equiv 1 \, mod \, 4 \qquad 2^2 \equiv 0 \, mod \, 4 \qquad  3^2 \equiv 1 \, mod \, 4 
	\end{align*}
	
\end{example}


\begin{remark}
	Por definición $0 \notin \mathbb{Z}^*_n$, y por tanto $0 \notin Q_n$ y $0 \notin \overline{Q_n}$.
\end{remark}



\begin{definition}
	Sea $a \in Q_n$. Si $x \in \mathbb{Z}^*_n$ satisface $ x^2 \equiv a \, mod \, n$, entonces $x$ se llama \textit{raíz cuadrada} módulo n de $a$.
\end{definition}



\begin{proposition}
	Sea $p$ un primo impar. Se cumple que $|Q_p| = \frac{p-1}{2}$ y $|\overline{Q_p}| = \frac{p-1}{2}$, es decir, la mitad de los elementos de $\mathbb{Z}^*_p$ son residuos cuadráticos, y la otra mitad no-residuos cuadráticos.
\end{proposition}

\begin{proof}
	Sea $\alpha \in \mathbb{Z}^*_p$ un generador de $\mathbb{Z}^*_p$.
	Un elemento $a \in \mathbb{Z}^*_p$ es un residuo cuadrático módulo p si y solo si $a \equiv \alpha^i \, mod \, p$ donde $i$ es un entero par. Como $p$ es primo, $\phi(p) = p-1 = |\mathbb{Z}^*_p|$, que es un entero par, y de ahí se sigue el enunciado, la mitad de los elementos son generados por un $i$ par, la otra mitad por un $i$ impar.
\end{proof}

\begin{example}
	Para $p=13$ tenemos que $\alpha = 6$ es un generador de $\mathbb{Z}^*_{13}$. Las potencias de $\alpha$ módulo 13 son:
	
	\begin{tabular}{|c||c|c|c|c|c|c|c|c|c|c|c|c|}
		 \hline
			$i$ & $1$ & $\underline{2}$ & $3$ & $\underline{4}$ & $5$ & $\underline{6}$ & $7$ & $\underline{8}$ & $9$ & $\underline{10}$ & $11$ & $\underline{12}$ \\
			\hline
			$6^i \, mod \, 13$ & $6$ & $10$ & $8$ & $9$ & $2$ & $12$ & $7$ & $3$ & $5$ & $4$ & $11$ & $1$ \\
		 \hline
	\end{tabular}

	\hfil

	Lo que nos da $Q_{13} = \{1,\,3,\,4,\,9,\,10,\,12\}$ y $\overline{Q_{13}} = \{2,\,5,\,6,\,7,\,8,\,11\}$.
\end{example}

\begin{proposition}
	Sea $n$ un producto de dos primos impares $p$ y $q$, $n = pq$. Entonces  $a \in \mathbb{Z}^*_p$ es un residuo cuadrático módulo $n$, $a \in Q_n$ si y solo si $a \in Q_p$ y $a \in Q_q$. Se sigue que $|Q_n| = |Q_p|\cdot |Q_q| = \frac{(p-1)(q-1)}{4}$, y por tanto  $\overline{|Q_n|} = |\mathbb{Z}^*_n| - |Q_n| = \frac{3(p-1)(q-1)}{4}$.
\end{proposition}

\begin{proof}	
	Si $a$ es un residuo cuadrático módulo $n=pq$, $a \equiv x^2  \, mod \, n$, es inmediato que en módulos $p$ y $q$ se cumple $a \equiv x^2  \, mod \, p$, $a \equiv x^2  \, mod \, q$.
	
	Si tenemos que $a$ es un residuo cuadrático módulo $p$, $a \equiv x_p^2 \, mod \, p$, y también módulo $q$, $a \equiv x_q^2 \, mod \, q$, por el Teorema Chino de los Restos existe un $x$ tal que:
	
	$x \equiv x_p \, mod \, p$ \quad y \quad $x \equiv x_q \, mod \, q$
	
	De modo que, elevando al cuadrado:
	
	$x^2 \equiv x_p^2 \equiv a \, mod \, p$
	
	$x^2 \equiv x_q^2 \equiv a \, mod \, q$
	
	Por lo que $x^2 \equiv a \, mod \, n$.
	
\end{proof}



% TODO: ¿hace falta? --> Sí
%\begin{proposition}
%	Si $p$ es un primo impar y $a \in Q_p$, entonces $a$ tiene exáctamente $2$ raíces módulo $p$.
%\end{proposition}





\section{Símbolo de Legendre}

Para identificar los residuos cuadráticos disponemos de una herramienta muy útil:

\begin{definition}
	Dados un primo impar $p$ y un entero $a$, se define el \textit{símbolo de Legendre} $\left( \frac{a}{p} \right) $ como
	
	\begin{center}
		$
		\left( \dfrac{a}{p} \right) = 
		\begin{cases}
			0, & si\ a \equiv 0 \, mod \, p\\
			1, & si\ a \in Q_p  \\
			-1, & si\ a \in \overline{Q_p} \\
		\end{cases}
		$
	\end{center}
\end{definition}

\hfil

Veamos ahora algunas propiedades del símbolo de Legendre:

\begin{theorem}[Criterio de Euler]
	Sea $p$ un primo impar. Sea $a \not\equiv 0 \, mod \, p$. Entonces:
	
 	\begin{center}
 		$ a^{(p-1)/2} \equiv \left( \dfrac{a}{p} \right)  \, mod \, p$
 	\end{center}
	
\end{theorem}

\hfil

\begin{proof}
	Observemos primero que las raíces de $1$ módulo $p$ son $1$ y $-1$ $mod\, p$. También que por el Teorema de Euler, $a^{\phi(p)} \equiv a^{p-1} \equiv 1 \, mod \, p$.
	
	De este modo, tenemos que $ a^{\frac{p-1}{2}} \equiv \pm 1 \, mod \, p$.
	
	Ahora demostrar el teorema es equivalente a demostrar que $a^{(p-1)/2} \equiv 1 \, mod \, p$ si y solo si $a$ es un residuo cuadrático.
	
	\hfil
	
	Supongamos que $a$ es un residuo cuadrático módulo $p$. Sea $x$ tal que $x^2 \equiv a \, mod \, p$. Entonces, $ a^{\frac{p-1}{2}} \equiv x^{(p-1)} \equiv 1 \, mod \, p$, de nuevo por el Teorema de Euler.
	
	\hfil
	
	Sea ahora  $ a^{\frac{p-1}{2}} \equiv 1 \, mod \, p$.
	
	Tomamos $g$ un generador de $\mathbb{Z}^*_p$, de modo que $a \equiv g^r \, mod \, p$.
	
	Sustituyendo:
	 $ g^{r\frac{p-1}{2}} \equiv 1 \, mod \, p$, 
	 y utilizando que $g$ tiene orden $p-1$, nos queda $ g^{r\frac{p-1}{2}} \equiv g^{\frac{r}{2}} \equiv 1 \, mod \, p$, de donde deducimos que necesariamente $r$ es un entero par, $r = 2s$.
	 
	 Construimos $x \equiv g^s \, mod \, p$, que cumple:
	 $x^2 \equiv g^{2s} \equiv g^r \equiv a \, mod \, p$,
	 de modo que $a$ es un residuo cuadrático módulo $p$.
	
\end{proof}

\begin{proposition}[Propiedad multiplicativa del símbolo de Lebesgue]
	Sean $a$ y $b$ enteros coprimos con $p$, un primo impar. Entonces:
	
\begin{center}
 	$
		\left( \dfrac{a}{p} \right) 	\left( \dfrac{b}{p} \right) = 	\left( \dfrac{ab}{p} \right) 
	$.
\end{center}
	
	En particular, el producto de dos no-residuos cuadráticos es un residuo cuadrático.
	
\end{proposition}

\begin{proof}
	Utilizando el Criterio de Euler:
	
	\[
			\left( \dfrac{a}{p} \right) 	\left( \dfrac{b}{p} \right) =
			a^{(p-1)/2} \cdot b^{(p-1)/2} = (ab)^{(p-1)/2} =
			 	\left( \dfrac{ab}{p} \right) 
	\]
	
\end{proof}

% TODO : hace falta? -> sí, para Jacobi
% https://proofwiki.org/wiki/Law_of_Quadratic_Reciprocity
\begin{theorem}[Ley de reciprocidad cuadrática]
	Sean $p$ y $q$ primos impares distintos, se cumple:
	
	\begin{center}
		$
	\left( \dfrac{p}{q} \right) 	\left( \dfrac{q}{p} \right) = \left( -1 \right) ^{(p-1)(q-1)/4}
	$.
	\end{center}
	O de otro modo:
	
	\begin{center}
		$
		\left({\dfrac p q}\right) = \begin{cases}
		\quad \left({\dfrac q p}\right) & Si\quad p \equiv 1 \, mod \, 4 \quad  ó \quad  q \equiv 1 \, mod \, 4 \\
		-\left({\dfrac q p}\right) & Si\quad p \equiv q \equiv 3 \, mod \, 4
		\end{cases}
		$.
	\end{center}
	
	\label{quadRec:theo}
	
	%TODO : las fórmulas extra del -1 y 2
	
\end{theorem}



\hfil

\section{Símbolo de Jacobi}

% TODO: la parte de Kronecker no haría falta
% TODO: notación Z^Q para designar símbolo Jacobi = 1, Z^Q = Z^Q+ U Z^Q-

El símbolo de Legendre está definido para módulos un primo impar $p$. Ahora vamos a ver una generalización del concepto:

\begin{definition}
	Sean $a,\,N\in \mathbb{Z}$, con $N = p_1 p_2 \cdots p_r$, donde los $p_i$ son primos impares, no necesariamente distintos.
	
	Definimos el \textit{Símbolo de Kronecker-Jacobi} $\left( \frac{a}{N} \right) $ como
		\[
		\left( \dfrac{a}{N} \right) = \prod_{i=1}^{r} \left( \dfrac{a}{p_i} \right)
		\]
		
	donde $\left( \frac{a}{p_i} \right)$ es el Símbolo de Legendre.
	 
\end{definition}

\begin{remark}
	A diferencia del Símbolo de Legendre, el Símbolo de Jacobi $\left( \frac{a}{N} \right) $ no indica si $a$ es un residuo cuadrático módulo $N$. Es cierto que si $a \in Q_N$, su Símbolo de Jacobi será $\left( \frac{a}{N} \right) = 1$, pero el contrario no se cumple.
\end{remark}

\begin{example}
	Sea $a=2$ y $N=15=3\cdot 5$.
	\begin{center}
		$\left( \dfrac{2}{15} \right) = \left( \dfrac{2}{3} \right) \left( \dfrac{2}{5} \right) =  \left(-1\right) \cdot  \left(-1\right) = 1$
	\end{center}
	Ya que $Q_3 = \{1\}$, $\overline{Q_3}=\{2\}$, y $Q_5 = \{1,4\}$, $\overline{Q_5}=\{2,3\}$.
\end{example}

\hfil

Igual que antes, veamos algunas propiedades del Símbolo de Jacobi:


\begin{theorem}
	Propiedades del Símbolo de Jacobi:
	
	\begin{enumerate}[label=(\roman*)]
		\item 	$\left( \frac{a}{N} \right) = 0$ si y sólo si $mcd(a, N) \neq 1$.
		\item Para cada $a$, $b$ y $c$ enteros, tenemos: \\
		
		\begin{center}
			$
			\left( \dfrac{ab}{c} \right) = \left( \dfrac{a}{c} \right) \left( \dfrac{b}{c} \right), \quad \left( \dfrac{a}{bc} \right) = \left( \dfrac{a}{b} \right) \left( \dfrac{a}{c} \right) \quad si\ bc \neq 0
			$.
		\end{center}
		
		%\item Fijado $N > 0$, el símbolo $ \left( \frac{a}{N} \right) $ es periódico en $a$ con periodo $N$ si $N \not\equiv 2 \, mod \, 4$, en otro caso, es periódico con periodo $4N$.
		
		%\item Fijado $a \neq 0$, el símbolo $ \left( \frac{a}{N} \right) $ es periódico en $N$ con periodo $|a|$ si $a \equiv 0 \ ó \ 1 \, mod \, 4$, en otro caso, es periódico con periodo $4|a|$.
		
		\item Las fórmulas del \autoref{quadRec:theo} se siguen verificando si $p$ y $q$ son enteros impares positivos, ya no necesitan ser primos.
		
	\end{enumerate}
\end{theorem}

%TODO: proof


\section{El problema de residuosidad cuadrática}


Indicar el problema, que es NP y que se puede reducir al de encontrar la factorización de N

